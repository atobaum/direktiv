runcmd:
 - snap install helm --classic
 - echo 'alias kc="kubectl"' >> /home/.bashrc
 - echo 'source <(kubectl completion bash)' >> /home/.bashrc
 - echo 'complete -F __start_kubectl kc' >> /home/.bashrc
 - echo 'export KUBECONFIG=/etc/rancher/k3s/k3s.yaml' >> /home/.bashrc
 - cat /home/.bashrc >> /home/ubuntu/.bashrc
 - chown -R ubuntu:ubuntu /home/install.sh
 - rm -Rf /home/.bashrc
 - mv /home/install.sh /home/ubuntu/
 - /home/ubuntu/install.sh gerke74/direktiv gerke74/ui latest
 

write_files:
- encoding: b64
  content: IyEvYmluL3NoCgojIHN0YXJ0IGszcyBhbmQgd2FpdCBmb3IgcG9kIHRvIGJlIHVwCmN1cmwgLXNmTCBodHRwczovL2dldC5rM3MuaW8gfCBzaCAtcyAtIC0tZGlzYWJsZSB0cmFlZmlrIC0td3JpdGUta3ViZWNvbmZpZy1tb2RlPTY0NAplY2hvICJ3YWl0aW5nIGZvciBrM3MiCgp3aGlsZSAhIGt1YmVjdGwgd2FpdCAtLWZvcj1jb25kaXRpb249cmVhZHkgLW4ga3ViZS1zeXN0ZW0gcG9kIC1sIGs4cy1hcHA9bWV0cmljcy1zZXJ2ZXIKZG8KICAgIGVjaG8gIndhaXRpbmcgZm9yIGszcyBwb2RzIgogICAgc2xlZXAgMQpkb25lCgoKIyBrbmF0aXZlCmt1YmVjdGwgYXBwbHkgLWYgaHR0cHM6Ly9naXRodWIuY29tL2tuYXRpdmUvb3BlcmF0b3IvcmVsZWFzZXMvZG93bmxvYWQva25hdGl2ZS12MS45LjQvb3BlcmF0b3IueWFtbAprdWJlY3RsIGNyZWF0ZSBucyBrbmF0aXZlLXNlcnZpbmcKa3ViZWN0bCBhcHBseSAtZiBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vZGlyZWt0aXYvZGlyZWt0aXYvbWFpbi9rdWJlcm5ldGVzL2luc3RhbGwva25hdGl2ZS9iYXNpYy55YW1sCgojIGRhdGFiYXNlCm1rZGlyIHB2CmNhdCA8PEVPRiA+IHB2L3B2LnlhbWwKYXBpVmVyc2lvbjogYXBwcy92MQpraW5kOiBEZXBsb3ltZW50Cm1ldGFkYXRhOgogIG5hbWU6IHBvc3RncmVzCnNwZWM6CiAgcmVwbGljYXM6IDEKICBzZWxlY3RvcjoKICAgIG1hdGNoTGFiZWxzOgogICAgICBhcHA6IHBvc3RncmVzCiAgdGVtcGxhdGU6CiAgICBtZXRhZGF0YToKICAgICAgbGFiZWxzOgogICAgICAgIGFwcDogcG9zdGdyZXMKICAgIHNwZWM6CiAgICAgIHZvbHVtZXM6CiAgICAgICAgLSBuYW1lOiBwb3N0Z3Jlcy1wdi1zdG9yYWdlCiAgICAgICAgICBwZXJzaXN0ZW50Vm9sdW1lQ2xhaW06CiAgICAgICAgICAgIGNsYWltTmFtZTogcG9zdGdyZXMtcHYtY2xhaW0KICAgICAgY29udGFpbmVyczoKICAgICAgICAtIG5hbWU6IHBvc3RncmVzCiAgICAgICAgICBpbWFnZTogcG9zdGdyZXM6MTMuNAogICAgICAgICAgaW1hZ2VQdWxsUG9saWN5OiBJZk5vdFByZXNlbnQKICAgICAgICAgIHBvcnRzOgogICAgICAgICAgICAtIGNvbnRhaW5lclBvcnQ6IDU0MzIKICAgICAgICAgIGVudjoKICAgICAgICAgICAgLSBuYW1lOiBQT1NUR1JFU19VU0VSCiAgICAgICAgICAgICAgdmFsdWU6IGRpcmVrdGl2CiAgICAgICAgICAgIC0gbmFtZTogUE9TVEdSRVNfREIKICAgICAgICAgICAgICB2YWx1ZTogZGlyZWt0aXYKICAgICAgICAgICAgLSBuYW1lOiBQT1NUR1JFU19QQVNTV09SRAogICAgICAgICAgICAgIHZhbHVlOiBkaXJla3RpdmRpcmVrdGl2CiAgICAgICAgICAgIC0gbmFtZTogUEdEQVRBCiAgICAgICAgICAgICAgdmFsdWU6IC92YXIvbGliL3Bvc3RncmVzcWwvZGF0YS9wZ2RhdGEKICAgICAgICAgIHZvbHVtZU1vdW50czoKICAgICAgICAgICAgLSBtb3VudFBhdGg6IC92YXIvbGliL3Bvc3RncmVzcWwvZGF0YQogICAgICAgICAgICAgIG5hbWU6IHBvc3RncmVzLXB2LXN0b3JhZ2UKRU9GCgpjYXQgPDxFT0YgPiBwdi9zdG9yYWdlLnlhbWwKYXBpVmVyc2lvbjogdjEKa2luZDogUGVyc2lzdGVudFZvbHVtZQptZXRhZGF0YToKICBuYW1lOiBwb3N0Z3Jlcy1wdi12b2x1bWUKc3BlYzoKICBzdG9yYWdlQ2xhc3NOYW1lOiBsb2NhbC1wYXRoCiAgY2FwYWNpdHk6CiAgICBzdG9yYWdlOiAxR2kKICBhY2Nlc3NNb2RlczoKICAgIC0gUmVhZFdyaXRlT25jZQogIGhvc3RQYXRoOgogICAgcGF0aDogIi90bXAvcGdkYXRhIgotLS0KYXBpVmVyc2lvbjogdjEKa2luZDogUGVyc2lzdGVudFZvbHVtZUNsYWltCm1ldGFkYXRhOgogIG5hbWU6IHBvc3RncmVzLXB2LWNsYWltCnNwZWM6CiAgc3RvcmFnZUNsYXNzTmFtZTogbG9jYWwtcGF0aAogIGFjY2Vzc01vZGVzOgogICAgLSBSZWFkV3JpdGVPbmNlCiAgcmVzb3VyY2VzOgogICAgcmVxdWVzdHM6CiAgICAgIHN0b3JhZ2U6IDFHaQotLS0KYXBpVmVyc2lvbjogdjEKa2luZDogU2VydmljZQptZXRhZGF0YToKICBuYW1lOiBwb3N0Z3JlcwogIGxhYmVsczoKICAgIGFwcDogcG9zdGdyZXMKc3BlYzoKICB0eXBlOiBDbHVzdGVySVAKICBwb3J0czoKICAgLSBwb3J0OiA1NDMyCiAgc2VsZWN0b3I6CiAgICBhcHA6IHBvc3RncmVzCkVPRgoKa3ViZWN0bCBhcHBseSAtZiBwdgoKIyBkb2NrZXIgcmVnaXN0cnkKbWtkaXIgcmVnaXN0cnkKCmNhdCA8PEVPRiA+IHJlZ2lzdHJ5L3JlZ2lzdHJ5LnlhbWwKYXBpVmVyc2lvbjogdjEKa2luZDogTmFtZXNwYWNlCm1ldGFkYXRhOgogIG5hbWU6IHJlZ2lzdHJ5LW5zCi0tLQphcGlWZXJzaW9uOiB2MQpraW5kOiBTZXJ2aWNlQWNjb3VudAptZXRhZGF0YToKICBuYW1lOiByZWdpc3RyeS1zYQogIG5hbWVzcGFjZTogcmVnaXN0cnktbnMKLS0tCmFwaVZlcnNpb246IHYxCmtpbmQ6IFBvZAptZXRhZGF0YToKICBuYW1lOiBkb2NrZXItcmVnaXN0cnktcG9kCiAgbmFtZXNwYWNlOiByZWdpc3RyeS1ucwogIGxhYmVsczoKICAgIGFwcDogcmVnaXN0cnkKc3BlYzoKICBzZXJ2aWNlQWNjb3VudE5hbWU6IHJlZ2lzdHJ5LXNhCiAgY29udGFpbmVyczoKICAtIG5hbWU6IHJlZ2lzdHJ5CiAgICBpbWFnZTogcmVnaXN0cnk6Mi43LjEKLS0tCmFwaVZlcnNpb246IHYxCmtpbmQ6IFNlcnZpY2UKbWV0YWRhdGE6CiAgbmFtZTogZG9ja2VyLXJlZ2lzdHJ5CiAgbmFtZXNwYWNlOiByZWdpc3RyeS1ucwpzcGVjOgogIHR5cGU6IE5vZGVQb3J0CiAgc2VsZWN0b3I6CiAgICBhcHA6IHJlZ2lzdHJ5CiAgcG9ydHM6CiAgLSBwb3J0OiA1MDAwCiAgICB0YXJnZXRQb3J0OiA1MDAwCiAgICBub2RlUG9ydDogMzEyMTIKRU9GCgprdWJlY3RsIGFwcGx5IC1mIHJlZ2lzdHJ5CgojIHdhaXRpbmcgZm9yIGRiCndoaWxlICEga3ViZWN0bCB3YWl0IC0tZm9yPWNvbmRpdGlvbj1yZWFkeSBwb2QgLWwgYXBwPXBvc3RncmVzCmRvCiAgICBlY2hvICJ3YWl0aW5nIGZvciBkYXRhYmFzZSIKICAgIHNsZWVwIDEKZG9uZQoKCiMgZGlyZWt0aXYKY2F0IDw8RU9GID4gZGlyZWt0aXYueWFtbApwdWxsUG9saWN5OiBJZk5vdFByZXNlbnQKZGVidWc6ICJ0cnVlIgoKZXZlbnRpbmc6CiAgZW5hYmxlZDogdHJ1ZQoKc2VjcmV0czoKICBpbWFnZTogIiQxIgogIHRhZzogIiQzIgpmbG93OgogIGltYWdlOiAiJDEiCiAgZGJpbWFnZTogIiQxIgogIHRhZzogIiQzIgp1aToKICBpbWFnZTogIiQyIgogIHRhZzogIiQzIgphcGk6CiAgaW1hZ2U6ICIkMSIKICB0YWc6ICIkMyIKZnVuY3Rpb25zOgogIG5hbWVzcGFjZTogZGlyZWt0aXYtc2VydmljZXMtZGlyZWt0aXYKICBpbWFnZTogIiQxIgogIHRhZzogIiQzIgogIHNpZGVjYXI6ICIkMSIKICBpbml0UG9kSW1hZ2U6ICJkaXJla3Rpdi9pbml0LXBvZCIKCmRhdGFiYXNlOgogICMgLS0gZGF0YWJhc2UgaG9zdAogIGhvc3Q6ICJwb3N0Z3JlcyIKICAjIC0tIGRhdGFiYXNlIHBvcnQKICBwb3J0OiA1NDMyCiAgIyAtLSBkYXRhYmFzZSB1c2VyCiAgdXNlcjogImRpcmVrdGl2IgogICMgLS0gZGF0YWJhc2UgcGFzc3dvcmQKICBwYXNzd29yZDogImRpcmVrdGl2ZGlyZWt0aXYiCiAgIyAtLSBkYXRhYmFzZSBuYW1lLCBhdXRvIGNyZWF0ZWQgaWYgaXQgZG9lcyBub3QgZXhpc3QKICBuYW1lOiAiZGlyZWt0aXYiCiAgIyAtLSBzc2xtb2RlIGZvciBkYXRhYmFzZQogIHNzbG1vZGU6IGRpc2FibGUKRU9GCgojIGhlbG0gcmVwbyBhZGQgZGlyZWt0aXYgaHR0cHM6Ly9jaGFydC5kaXJla3Rpdi5pbwojIGhlbG0gcmVwbyBhZGQgcHJvbWV0aGV1cyBodHRwczovL3Byb21ldGhldXMtY29tbXVuaXR5LmdpdGh1Yi5pby9oZWxtLWNoYXJ0cwojIGhlbG0gcmVwbyBhZGQgaW5ncmVzcy1uZ2lueCBodHRwczovL2t1YmVybmV0ZXMuZ2l0aHViLmlvL2luZ3Jlc3MtbmdpbngKZ2l0IGNsb25lIC1iIG9uZS1iaW5hcnkgaHR0cHM6Ly9naXRodWIuY29tL2RpcmVrdGl2L2RpcmVrdGl2LWNoYXJ0cy5naXQKCmNkIGBwd2RgL2RpcmVrdGl2LWNoYXJ0cy9jaGFydHMvZGlyZWt0aXYgJiYgXAogICAgaGVsbSByZXBvIGFkZCBkaXJla3RpdiBodHRwczovL2NoYXJ0LmRpcmVrdGl2LmlvICYmIFwKICAgIGhlbG0gcmVwbyBhZGQgaW5ncmVzcy1uZ2lueCBodHRwczovL2t1YmVybmV0ZXMuZ2l0aHViLmlvL2luZ3Jlc3MtbmdpbnggJiYgXAogICAgaGVsbSByZXBvIGFkZCBwcm9tZXRoZXVzIGh0dHBzOi8vcHJvbWV0aGV1cy1jb21tdW5pdHkuZ2l0aHViLmlvL2hlbG0tY2hhcnRzICYmIFwKICAgIGhlbG0gcmVwbyBsaXN0ICYmIFwKICAgIGhlbG0gZGVwZW5kZW5jeSBidWlsZCAmJiBcIAogICAgS1VCRUNPTkZJRz0vZXRjL3JhbmNoZXIvazNzL2szcy55YW1sIGhlbG0gaW5zdGFsbCAtZiAvZGlyZWt0aXYueWFtbCBkaXJla3RpdiAuCgojIGV2ZW50aW5nCmt1YmVjdGwgY3JlYXRlIG5zIGtuYXRpdmUtZXZlbnRpbmcKCmNhdCA8PEVPRiA+IGV2ZW50aW5nLnlhbWwKYXBpVmVyc2lvbjogb3BlcmF0b3Iua25hdGl2ZS5kZXYvdjFiZXRhMQpraW5kOiBLbmF0aXZlRXZlbnRpbmcKbWV0YWRhdGE6CiAgbmFtZToga25hdGl2ZS1ldmVudGluZwogIG5hbWVzcGFjZToga25hdGl2ZS1ldmVudGluZwpFT0YKCmt1YmVjdGwgYXBwbHkgLWYgZXZlbnRpbmcueWFtbAoKIyBjb250b3VyCmt1YmVjdGwgYXBwbHkgLS1maWxlbmFtZSBodHRwczovL2dpdGh1Yi5jb20va25hdGl2ZS9uZXQtY29udG91ci9yZWxlYXNlcy9kb3dubG9hZC9rbmF0aXZlLXYxLjkuMy9jb250b3VyLnlhbWwKa3ViZWN0bCBkZWxldGUgbnMgY29udG91ci1leHRlcm5hbCAmCgojIHdhaXRpbmcgZm9yIGRpcmVrdGl2CndoaWxlICEga3ViZWN0bCB3YWl0IC0tZm9yPWNvbmRpdGlvbj1yZWFkeSBwb2QgLWwgYXBwLmt1YmVybmV0ZXMuaW8vbmFtZT1kaXJla3RpdgpkbwogICAgZWNobyAid2FpdGluZyBmb3IgZGlyZWt0aXYiCiAgICBzbGVlcCAxCmRvbmUKCm49MAp1bnRpbCBbICIkbiIgLWdlIDI0IF0KZG8KICAgY3VybCAtWCBQVVQgaHR0cDovL2xvY2FsaG9zdC9hcGkvbmFtZXNwYWNlcy9leGFtcGxlcyBcCiAgICAgLUggIkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vanNvbiIgXAogICAgIC0td3JpdGUtb3V0ICIle2h0dHBfY29kZX0iIFwKICAgICAtZiBcCiAgICAgLWQgJ3sgInVybCI6ICJodHRwczovL2dpdGh1Yi5jb20vZGlyZWt0aXYvZGlyZWt0aXYtZXhhbXBsZXMuZ2l0IiwgInJlZiI6ICJtYWluIiB9JyAmJiBicmVhawogICBuPSQoKG4rMSkpCiAgIHNsZWVwIDEwCmRvbmUKCgoK
  path: /home/install.sh
  permissions: '0755'
