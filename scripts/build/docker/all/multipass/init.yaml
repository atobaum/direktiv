runcmd:
 - snap install helm --classic
 - echo 'alias kc="kubectl"' >> /home/.bashrc
 - echo 'source <(kubectl completion bash)' >> /home/.bashrc
 - echo 'complete -F __start_kubectl kc' >> /home/.bashrc
 - echo 'export KUBECONFIG=/etc/rancher/k3s/k3s.yaml' >> /home/.bashrc
 - cat /home/.bashrc >> /home/ubuntu/.bashrc
 - chown -R ubuntu:ubuntu /home/install.sh
 - rm -Rf /home/.bashrc
 - mv /home/install.sh /home/ubuntu/
 - /home/ubuntu/install.sh direktiv/direktiv direktiv/frontend v0.8.0
 

write_files:
- encoding: b64
  content: IyEvYmluL2Jhc2gKCmV4cG9ydCAkKGNhdCAvZW52IHwgeGFyZ3MpCgojIHN0YXJ0IGszcyBhbmQgd2FpdCBmb3IgcG9kIHRvIGJlIHVwCmN1cmwgLXNmTCBodHRwczovL2dldC5rM3MuaW8gfCBzaCAtcyAtIC0tZGlzYWJsZSB0cmFlZmlrIC0td3JpdGUta3ViZWNvbmZpZy1tb2RlPTY0NAplY2hvICJ3YWl0aW5nIGZvciBrM3MiCgp3aGlsZSAhIGt1YmVjdGwgd2FpdCAtLWZvcj1jb25kaXRpb249cmVhZHkgLW4ga3ViZS1zeXN0ZW0gcG9kIC1sIGs4cy1hcHA9bWV0cmljcy1zZXJ2ZXIKZG8KICAgIGVjaG8gIndhaXRpbmcgZm9yIGszcyBwb2RzIgogICAgc2xlZXAgMQpkb25lCgojIGtuYXRpdmUKa3ViZWN0bCBhcHBseSAtZiBodHRwczovL2dpdGh1Yi5jb20va25hdGl2ZS9vcGVyYXRvci9yZWxlYXNlcy9kb3dubG9hZC9rbmF0aXZlLXYxLjExLjYvb3BlcmF0b3IueWFtbAprdWJlY3RsIGNyZWF0ZSBucyBrbmF0aXZlLXNlcnZpbmcKCmlmIFsgLW4gIiR7SFRUUFNfUFJPWFkrMX0iIF07IHRoZW4KICBlY2hvICJhZGRpbmcgcHJveHkgdG8ga25hdGl2ZSIKICBjdXJsIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9kaXJla3Rpdi9kaXJla3Rpdi9tYWluL2t1YmVybmV0ZXMvaW5zdGFsbC9rbmF0aXZlL2Jhc2ljLnlhbWwgPiBrbmF0aXZlLnlhbWwKCiAgbG49JChhd2sgJy9uYW1lOiBjb250cm9sbGVyLyB7cHJpbnQgRk5SfScga25hdGl2ZS55YW1sKQogIG51bT0kKChsbiArIDEpKQoKICBWQVI9JChjYXQgPDwtRU5ECiAgICBlbnY6CiAgICAgIC0gY29udGFpbmVyOiBjb250cm9sbGVyCiAgICAgICAgZW52VmFyczoKICAgICAgICAtIG5hbWU6IEhUVFBfUFJPWFkKICAgICAgICAgIHZhbHVlOiAiJHtIVFRQX1BST1hZfSIKICAgICAgICAtIG5hbWU6IEhUVFBTX1BST1hZCiAgICAgICAgICB2YWx1ZTogIiR7SFRUUF9QUk9YWX0iCiAgICAgICAgLSBuYW1lOiBOT19QUk9YWQogICAgICAgICAgdmFsdWU6ICIke05PX1BST1hZfSIKRU5ECikKCiAgICBlZCAtdiBrbmF0aXZlLnlhbWwgPDxFTkQKJHtudW19aQoke1ZBUn0KLgp3CnEKRU5ECgogIGt1YmVjdGwgYXBwbHkgLWYga25hdGl2ZS55YW1sCmVsc2UKICBrdWJlY3RsIGFwcGx5IC1mIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9kaXJla3Rpdi9kaXJla3Rpdi9tYWluL2t1YmVybmV0ZXMvaW5zdGFsbC9rbmF0aXZlL2Jhc2ljLnlhbWwKZmkKCiMgZGF0YWJhc2UKbWtkaXIgcHYKY2F0IDw8RU9GID4gcHYvcHYueWFtbAphcGlWZXJzaW9uOiBhcHBzL3YxCmtpbmQ6IERlcGxveW1lbnQKbWV0YWRhdGE6CiAgbmFtZTogcG9zdGdyZXMKc3BlYzoKICByZXBsaWNhczogMQogIHNlbGVjdG9yOgogICAgbWF0Y2hMYWJlbHM6CiAgICAgIGFwcDogcG9zdGdyZXMKICB0ZW1wbGF0ZToKICAgIG1ldGFkYXRhOgogICAgICBsYWJlbHM6CiAgICAgICAgYXBwOiBwb3N0Z3JlcwogICAgc3BlYzoKICAgICAgdm9sdW1lczoKICAgICAgICAtIG5hbWU6IHBvc3RncmVzLXB2LXN0b3JhZ2UKICAgICAgICAgIHBlcnNpc3RlbnRWb2x1bWVDbGFpbToKICAgICAgICAgICAgY2xhaW1OYW1lOiBwb3N0Z3Jlcy1wdi1jbGFpbQogICAgICBjb250YWluZXJzOgogICAgICAgIC0gbmFtZTogcG9zdGdyZXMKICAgICAgICAgIGltYWdlOiBwb3N0Z3JlczoxMy40CiAgICAgICAgICBpbWFnZVB1bGxQb2xpY3k6IElmTm90UHJlc2VudAogICAgICAgICAgcG9ydHM6CiAgICAgICAgICAgIC0gY29udGFpbmVyUG9ydDogNTQzMgogICAgICAgICAgZW52OgogICAgICAgICAgICAtIG5hbWU6IFBPU1RHUkVTX1VTRVIKICAgICAgICAgICAgICB2YWx1ZTogZGlyZWt0aXYKICAgICAgICAgICAgLSBuYW1lOiBQT1NUR1JFU19EQgogICAgICAgICAgICAgIHZhbHVlOiBkaXJla3RpdgogICAgICAgICAgICAtIG5hbWU6IFBPU1RHUkVTX1BBU1NXT1JECiAgICAgICAgICAgICAgdmFsdWU6IGRpcmVrdGl2ZGlyZWt0aXYKICAgICAgICAgICAgLSBuYW1lOiBQR0RBVEEKICAgICAgICAgICAgICB2YWx1ZTogL3Zhci9saWIvcG9zdGdyZXNxbC9kYXRhL3BnZGF0YQogICAgICAgICAgdm9sdW1lTW91bnRzOgogICAgICAgICAgICAtIG1vdW50UGF0aDogL3Zhci9saWIvcG9zdGdyZXNxbC9kYXRhCiAgICAgICAgICAgICAgbmFtZTogcG9zdGdyZXMtcHYtc3RvcmFnZQpFT0YKCmNhdCA8PEVPRiA+IHB2L3N0b3JhZ2UueWFtbAphcGlWZXJzaW9uOiB2MQpraW5kOiBQZXJzaXN0ZW50Vm9sdW1lCm1ldGFkYXRhOgogIG5hbWU6IHBvc3RncmVzLXB2LXZvbHVtZQpzcGVjOgogIHN0b3JhZ2VDbGFzc05hbWU6IGxvY2FsLXBhdGgKICBjYXBhY2l0eToKICAgIHN0b3JhZ2U6IDFHaQogIGFjY2Vzc01vZGVzOgogICAgLSBSZWFkV3JpdGVPbmNlCiAgaG9zdFBhdGg6CiAgICBwYXRoOiAiL3RtcC9wZ2RhdGEiCi0tLQphcGlWZXJzaW9uOiB2MQpraW5kOiBQZXJzaXN0ZW50Vm9sdW1lQ2xhaW0KbWV0YWRhdGE6CiAgbmFtZTogcG9zdGdyZXMtcHYtY2xhaW0Kc3BlYzoKICBzdG9yYWdlQ2xhc3NOYW1lOiBsb2NhbC1wYXRoCiAgYWNjZXNzTW9kZXM6CiAgICAtIFJlYWRXcml0ZU9uY2UKICByZXNvdXJjZXM6CiAgICByZXF1ZXN0czoKICAgICAgc3RvcmFnZTogMUdpCi0tLQphcGlWZXJzaW9uOiB2MQpraW5kOiBTZXJ2aWNlCm1ldGFkYXRhOgogIG5hbWU6IHBvc3RncmVzCiAgbGFiZWxzOgogICAgYXBwOiBwb3N0Z3JlcwpzcGVjOgogIHR5cGU6IENsdXN0ZXJJUAogIHBvcnRzOgogICAtIHBvcnQ6IDU0MzIKICBzZWxlY3RvcjoKICAgIGFwcDogcG9zdGdyZXMKRU9GCgprdWJlY3RsIGFwcGx5IC1mIHB2CgojIGRvY2tlciByZWdpc3RyeQpta2RpciByZWdpc3RyeQoKY2F0IDw8RU9GID4gcmVnaXN0cnkvcmVnaXN0cnkueWFtbAphcGlWZXJzaW9uOiB2MQpraW5kOiBOYW1lc3BhY2UKbWV0YWRhdGE6CiAgbmFtZTogcmVnaXN0cnktbnMKLS0tCmFwaVZlcnNpb246IHYxCmtpbmQ6IFNlcnZpY2VBY2NvdW50Cm1ldGFkYXRhOgogIG5hbWU6IHJlZ2lzdHJ5LXNhCiAgbmFtZXNwYWNlOiByZWdpc3RyeS1ucwotLS0KYXBpVmVyc2lvbjogdjEKa2luZDogUG9kCm1ldGFkYXRhOgogIG5hbWU6IGRvY2tlci1yZWdpc3RyeS1wb2QKICBuYW1lc3BhY2U6IHJlZ2lzdHJ5LW5zCiAgbGFiZWxzOgogICAgYXBwOiByZWdpc3RyeQpzcGVjOgogIHNlcnZpY2VBY2NvdW50TmFtZTogcmVnaXN0cnktc2EKICBjb250YWluZXJzOgogIC0gbmFtZTogcmVnaXN0cnkKICAgIGltYWdlOiByZWdpc3RyeToyLjcuMQotLS0KYXBpVmVyc2lvbjogdjEKa2luZDogU2VydmljZQptZXRhZGF0YToKICBuYW1lOiBkb2NrZXItcmVnaXN0cnkKICBuYW1lc3BhY2U6IHJlZ2lzdHJ5LW5zCnNwZWM6CiAgdHlwZTogTm9kZVBvcnQKICBzZWxlY3RvcjoKICAgIGFwcDogcmVnaXN0cnkKICBwb3J0czoKICAtIHBvcnQ6IDUwMDAKICAgIHRhcmdldFBvcnQ6IDUwMDAKICAgIG5vZGVQb3J0OiAzMTIxMgpFT0YKCmt1YmVjdGwgYXBwbHkgLWYgcmVnaXN0cnkKCiMgd2FpdGluZyBmb3IgZGIKd2hpbGUgISBrdWJlY3RsIHdhaXQgLS1mb3I9Y29uZGl0aW9uPXJlYWR5IHBvZCAtbCBhcHA9cG9zdGdyZXMKZG8KICAgIGVjaG8gIndhaXRpbmcgZm9yIGRhdGFiYXNlIgogICAgc2xlZXAgMQpkb25lCgoKIyBkaXJla3RpdgpjYXQgPDxFT0YgPiBkaXJla3Rpdi55YW1sCnB1bGxQb2xpY3k6IElmTm90UHJlc2VudApkZWJ1ZzogInRydWUiCgpldmVudGluZzoKICBlbmFibGVkOiB0cnVlCgpmbG93OgogIGltYWdlOiAiJDEiCiAgZGJpbWFnZTogIiQxIgogIHRhZzogIiQzIgpmcm9uZW5kOgogIGltYWdlOiAiJDIiCiAgdGFnOiAiJDMiCmFwaToKICBpbWFnZTogIiQxIgogIHRhZzogIiQzIgpmdW5jdGlvbnM6CiAgbmFtZXNwYWNlOiBkaXJla3Rpdi1zZXJ2aWNlcy1kaXJla3RpdgogIGltYWdlOiAiJDEiCiAgdGFnOiAiJDMiCiAgc2lkZWNhcjogIiQxIgogIGluaXRQb2RJbWFnZTogImRpcmVrdGl2L2luaXQtcG9kIgokKGlmIFsgLW4gIiR7SFRUUFNfUFJPWFkrMX0iIF07IHRoZW4KICBlY2hvICIgIGh0dHBfcHJveHk6ICR7SFRUUF9QUk9YWX0iCiAgZWNobyAiICBodHRwc19wcm94eTogJHtIVFRQU19QUk9YWX0iCiAgZWNobyAiICBub19wcm94eTogJHtOT19QUk9YWX0iCmZpKQoKZGF0YWJhc2U6CiAgIyAtLSBkYXRhYmFzZSBob3N0CiAgaG9zdDogInBvc3RncmVzIgogICMgLS0gZGF0YWJhc2UgcG9ydAogIHBvcnQ6IDU0MzIKICAjIC0tIGRhdGFiYXNlIHVzZXIKICB1c2VyOiAiZGlyZWt0aXYiCiAgIyAtLSBkYXRhYmFzZSBwYXNzd29yZAogIHBhc3N3b3JkOiAiZGlyZWt0aXZkaXJla3RpdiIKICAjIC0tIGRhdGFiYXNlIG5hbWUsIGF1dG8gY3JlYXRlZCBpZiBpdCBkb2VzIG5vdCBleGlzdAogIG5hbWU6ICJkaXJla3RpdiIKICAjIC0tIHNzbG1vZGUgZm9yIGRhdGFiYXNlCiAgc3NsbW9kZTogZGlzYWJsZQoKJChpZiBbIC1uICIke0hUVFBTX1BST1hZKzF9IiBdOyB0aGVuCiAgZWNobyAiaHR0cF9wcm94eTogJHtIVFRQX1BST1hZfSIKICBlY2hvICJodHRwc19wcm94eTogJHtIVFRQU19QUk9YWX0iCiAgZWNobyAibm9fcHJveHk6ICR7Tk9fUFJPWFl9IgpmaSkKCiQoaWYgWyAtbiAiJHtBUElLRVkrMX0iIF07IHRoZW4KICBlY2hvICJhcGlrZXk6IFwiJHtBUElLRVl9XCIiCmZpKQpFT0YKCmdpdCBjbG9uZSBodHRwczovL2dpdGh1Yi5jb20vZGlyZWt0aXYvZGlyZWt0aXYtY2hhcnRzLmdpdAoKY2QgYHB3ZGAvZGlyZWt0aXYtY2hhcnRzL2NoYXJ0cy9kaXJla3RpdiAmJiBcCiAgICBoZWxtIHJlcG8gYWRkIGRpcmVrdGl2IGh0dHBzOi8vY2hhcnQuZGlyZWt0aXYuaW8gJiYgXAogICAgaGVsbSByZXBvIGFkZCBpbmdyZXNzLW5naW54IGh0dHBzOi8va3ViZXJuZXRlcy5naXRodWIuaW8vaW5ncmVzcy1uZ2lueCAmJiBcCiAgICBoZWxtIHJlcG8gYWRkIHByb21ldGhldXMgaHR0cHM6Ly9wcm9tZXRoZXVzLWNvbW11bml0eS5naXRodWIuaW8vaGVsbS1jaGFydHMgJiYgXAogICAgaGVsbSByZXBvIGxpc3QgJiYgXAogICAgaGVsbSBkZXBlbmRlbmN5IGJ1aWxkICYmIFwgCiAgICBLVUJFQ09ORklHPS9ldGMvcmFuY2hlci9rM3MvazNzLnlhbWwgaGVsbSBpbnN0YWxsIC1mIC9kaXJla3Rpdi55YW1sIGRpcmVrdGl2IC4KCiMgZXZlbnRpbmcKa3ViZWN0bCBjcmVhdGUgbnMga25hdGl2ZS1ldmVudGluZwoKY2F0IDw8RU9GID4gZXZlbnRpbmcueWFtbAphcGlWZXJzaW9uOiBvcGVyYXRvci5rbmF0aXZlLmRldi92MWJldGExCmtpbmQ6IEtuYXRpdmVFdmVudGluZwptZXRhZGF0YToKICBuYW1lOiBrbmF0aXZlLWV2ZW50aW5nCiAgbmFtZXNwYWNlOiBrbmF0aXZlLWV2ZW50aW5nCkVPRgoKa3ViZWN0bCBhcHBseSAtZiBldmVudGluZy55YW1sCgojIGNvbnRvdXIKa3ViZWN0bCBhcHBseSAtLWZpbGVuYW1lIGh0dHBzOi8vZ2l0aHViLmNvbS9rbmF0aXZlL25ldC1jb250b3VyL3JlbGVhc2VzL2Rvd25sb2FkL2tuYXRpdmUtdjEuMTEuMC9jb250b3VyLnlhbWwKa3ViZWN0bCBkZWxldGUgbnMgY29udG91ci1leHRlcm5hbCAmCgojIHdhaXRpbmcgZm9yIGRpcmVrdGl2CndoaWxlICEga3ViZWN0bCB3YWl0IC0tZm9yPWNvbmRpdGlvbj1yZWFkeSBwb2QgLWwgYXBwLmt1YmVybmV0ZXMuaW8vbmFtZT1kaXJla3RpdgpkbwogICAgZWNobyAid2FpdGluZyBmb3IgZGlyZWt0aXYiCiAgICBzbGVlcCAxCmRvbmUKCm49MAp1bnRpbCBbICIkbiIgLWdlIDI0IF0KZG8KICAgY3VybCAtWCBQVVQgaHR0cDovL2xvY2FsaG9zdC9hcGkvbmFtZXNwYWNlcy9leGFtcGxlcyBcCiAgICAgLUggIkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vanNvbiIgXAogICAgIC1IICJEaXJla3Rpdi1Ub2tlbjogJHtBUElLRVl9IiBcCiAgICAgLS13cml0ZS1vdXQgIiV7aHR0cF9jb2RlfSIgXAogICAgIC1mIFwKICAgICAtZCAneyAidXJsIjogImh0dHBzOi8vZ2l0aHViLmNvbS9kaXJla3Rpdi9kaXJla3Rpdi1leGFtcGxlcy5naXQiLCAicmVmIjogIm1haW4iIH0nICYmIGJyZWFrCiAgIG49JCgobisxKSkKICAgc2xlZXAgMTAKZG9uZQoKCgo=
  path: /home/install.sh
  permissions: '0755'